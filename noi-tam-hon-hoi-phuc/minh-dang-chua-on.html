<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Điểm Danh Cảm Xúc (SDQ) | HOPE Project</title>
    
    <link rel="icon" href="data:,">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap&subset=vietnamese" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- STYLE ĐỒNG BỘ: HỒI PHỤC --- */
        :root {
            --primary: #9575CD;       /* Tím Lavender */
            --primary-dark: #7E57C2;
            --accent: #26A69A;        /* Xanh Mint đậm */
            --bg-gradient: linear-gradient(135deg, #F3E5F5 0%, #E0F2F1 100%);
            --text-main: #555;
            --text-heading: #2d3436;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 32px 0 rgba(149, 117, 205, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }

        body {
            font-family: 'Nunito', sans-serif;
            color: var(--text-main);
            background: var(--bg-gradient);
            line-height: 1.8;
            overflow-x: hidden;
        }

        /* --- HEADER & NAV --- */
        .top-disclaimer {
            background-color: var(--accent);
            color: white;
            text-align: center;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(149, 117, 205, 0.2);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        nav { display: flex; justify-content: space-between; align-items: center; height: 70px; }

        .logo { 
            font-size: 1.5rem; font-weight: 800; color: var(--primary); 
            text-decoration: none; display: flex; align-items: center; gap: 8px;
            white-space: nowrap; 
        }
        
        .nav-links { display: flex; gap: 20px; list-style: none; align-items: center; margin: 0; padding: 0; }
        .nav-links li { position: relative; height: 100%; display: flex; align-items: center; }
        
        .nav-links > li > a { 
            text-decoration: none; color: var(--text-heading); font-weight: 600; 
            transition: 0.3s; position: relative; display: inline-block; 
            padding: 10px 0; line-height: 1.5; white-space: nowrap;
        }
        .nav-links > li > a:hover, .nav-links > li > a.active { color: var(--primary-dark); }
        .nav-links > li > a.active::after { 
            content: ''; position: absolute; width: 100%; height: 3px; bottom: -8px; left: 0; background-color: var(--primary); border-radius: 2px; 
        }

        /* Dropdown */
        .dropdown-content {
            display: none; position: absolute; background-color: #fff; min-width: 240px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); z-index: 999; top: 100%; left: 0;
            border-radius: 10px; padding: 10px 0; border: 1px solid rgba(0,0,0,0.05);
            flex-direction: column; animation: fadeIn 0.3s ease;
        }
        .nav-links li:hover .dropdown-content { display: flex; }
        .dropdown-content li { width: 100%; display: block; height: auto; }
        
        .dropdown-content a {
            color: #555 !important; padding: 12px 20px; text-decoration: none; display: block;
            font-size: 0.95rem; font-weight: 500; transition: all 0.2s; white-space: nowrap;
        }
        .dropdown-content a:hover { background-color: #F3E5F5; color: var(--primary) !important; padding-left: 25px; }
        .dropdown-content::before { content: ''; position: absolute; top: -6px; left: 20px; width: 12px; height: 12px; background: white; transform: rotate(45deg); border-top: 1px solid rgba(0,0,0,0.05); border-left: 1px solid rgba(0,0,0,0.05); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .btn-cta { 
            padding: 8px 20px; background: var(--primary); color: white; border-radius: 50px; 
            text-decoration: none; font-weight: 700; transition: 0.3s; white-space: nowrap; flex-shrink: 0;
        }
        .btn-cta:hover { background: var(--primary-dark); transform: translateY(-2px); }

        /* --- HERO SECTION --- */
        .page-hero {
            text-align: center; padding: 80px 0 60px;
            background: url('https://images.unsplash.com/photo-1499209974431-9dddcece7f88?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80') no-repeat center center/cover;
            position: relative; color: white; border-radius: 0 0 50px 50px; margin-bottom: 60px;
        }
        .page-hero::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(94, 53, 177, 0.7); border-radius: 0 0 50px 50px;
        }
        .hero-content { position: relative; z-index: 1; }
        .hero-content h1 { font-size: 2.8rem; margin-bottom: 15px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .hero-content p { font-size: 1.2rem; opacity: 0.95; max-width: 800px; margin: 0 auto; }

        /* --- CONTENT --- */
        .content-block {
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 60px;
        }

        h2 { color: var(--primary-dark); font-size: 2rem; margin-bottom: 30px; text-align: center; position: relative; }
        h2::after { content: ''; display: block; width: 80px; height: 4px; background: var(--accent); margin: 10px auto 0; border-radius: 2px; }

        .science-box {
            background: #E0F2F1; padding: 20px; border-radius: 10px; border-left: 5px solid var(--accent);
            margin: 20px 0; font-size: 0.95rem;
        }
        .science-box strong { color: #00695C; }

        /* --- SURVEY FORM --- */
        .survey-section h3 {
            background: var(--primary); color: white; padding: 15px 20px; border-radius: 10px;
            margin-bottom: 20px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px;
        }
        
        .question-group { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px dashed #eee; }
        .question-text { font-weight: 600; margin-bottom: 10px; display: block; color: #333; }
        
        .options-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .radio-label {
            display: flex; align-items: center; gap: 8px; cursor: pointer; 
            background: #f9f9f9; padding: 8px 15px; border-radius: 50px; transition: 0.2s;
            border: 1px solid #eee; font-size: 0.95rem;
        }
        .radio-label:hover { background: #F3E5F5; border-color: var(--primary); }
        .radio-label input[type="radio"] { accent-color: var(--primary); transform: scale(1.2); }

        textarea, select, input[type="text"] {
            width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 10px;
            font-family: 'Nunito', sans-serif; margin-top: 10px; font-size: 1rem;
        }
        textarea:focus, select:focus, input[type="text"]:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(149, 117, 205, 0.2); }

        .submit-btn {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white; padding: 15px 40px; border: none; border-radius: 50px;
            font-family: 'Nunito', sans-serif; font-size: 1.2rem; font-weight: 700;
            cursor: pointer; transition: 0.3s; display: block; margin: 30px auto 0; 
            box-shadow: 0 5px 15px rgba(126, 87, 194, 0.4);
        }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(126, 87, 194, 0.5); }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        /* --- AI RESULT MODAL --- */
        #aiResultModal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
        }
        .ai-modal-content {
            background-color: white; margin: 2% auto; padding: 40px; border: none;
            width: 90%; max-width: 800px; border-radius: 20px; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .ai-loading { text-align: center; display: none; }
        .ai-spinner {
            border: 5px solid #f3f3f3; border-top: 5px solid var(--accent); border-radius: 50%;
            width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .ai-response-text {
            background: #F3E5F5; padding: 30px; border-radius: 15px; border-left: 6px solid var(--primary);
            margin-top: 20px; color: #333; font-size: 1rem; max-height: 50vh; overflow-y: auto;
        }
        
        .ai-response-text h2 { color: var(--primary-dark); border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 20px; font-size: 1.5rem; border-left: none; }
        .ai-response-text h3 { color: var(--accent); margin-top: 20px; font-size: 1.2rem; }
        .ai-response-text ul, .ai-response-text ol { margin-left: 20px; margin-bottom: 15px; }
        .ai-response-text li { margin-bottom: 5px; }
        .ai-response-text strong { color: var(--primary-dark); }

        /* FOLLOW UP SECTION */
        .ai-follow-up {
            margin-top: 30px; text-align: center; background: #E3F2FD; 
            padding: 25px; border-radius: 15px; border: 2px dashed #64B5F6;
        }
        .follow-up-btns {
            display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;
        }
        
        /* Footer */
        footer { background: linear-gradient(to right, var(--primary-dark), #512DA8); color: white; padding: 60px 0 20px; text-align: center; margin-top: 50px; }
        .footer-links a { color: white; margin: 0 10px; font-size: 1.5rem; }

        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hero-content h1 { font-size: 2rem; }
            .options-container { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <nav>
                <a href="../index.html" class="logo">
                    <i class="fas fa-heartbeat" style="color: var(--accent);"></i> HOPE Project
                </a>
                <ul class="nav-links">
                    <li><a href="../index.html">Trang chủ</a></li>
                    <li><a href="../hieu-ve-ban-than/index.html">Hiểu về bản thân</a></li>
                    <li class="dropdown">
                        <a href="../thu-thach-tuoi-teen/index.html">Thử thách tuổi teen <i class="fas fa-chevron-down" style="font-size: 0.8em; margin-left: 5px;"></i></a>
                        <ul class="dropdown-content">
                            <li><a href="../thu-thach-tuoi-teen/roi-loan-lo-au.html">Rối loạn lo âu</a></li>
                            <li><a href="../thu-thach-tuoi-teen/tram-cam.html">Trầm cảm</a></li>
                            <li><a href="../thu-thach-tuoi-teen/cung-on-dinh-lai-tam-trang.html">Cùng ổn định lại tâm trạng</a></li>
                        </ul>
                    </li>
                    <li><a href="../tram-sac-nang-luong/index.html">Trạm sạc</a></li>
                    <li class="dropdown">
                        <a href="index.html" class="active">Nơi tâm hồn hồi phục <i class="fas fa-chevron-down" style="font-size: 0.8em; margin-left: 5px;"></i></a>
                        <ul class="dropdown-content" style="min-width: 250px;">
                            <li><a href="khi-nao-can-gap-chuyen-gia.html">Khi nào cần gặp chuyên gia</a></li>
                            <li><a href="dia-chi-tin-cay.html">Địa chỉ tin cậy</a></li>
                            <li><a href="minh-dang-chua-on.html" class="active">Mình đang chưa ổn</a></li>
                            <li><a href="om-ban-mot-cai.html">Ở đây có những cái ôm</a></li>
                        </ul>
                    </li>
                </ul>
                <a href="minh-dang-chua-on.html" class="btn-cta">Cần giúp đỡ?</a>
            </nav>
        </div>
    </header>

    <section class="page-hero">
        <div class="container hero-content">
            <h1>Điểm Danh Cảm Xúc (SDQ)</h1>
            <p>Bạn Có Đang "Rối Ren" Hơn Mình Tưởng? Hãy để HOPE lắng nghe bạn.</p>
        </div>
    </section>

    <main class="container">

        <section class="content-block">
            <h2>SDQ Là Gì Mà "Xịn Xò" Thế?</h2>
            <p>Bạn có bao giờ tự hỏi: "Mình có đang ổn không nhỉ?". Đôi khi, chúng ta rất khó để tự mình trả lời. Tại HOPE, chúng mình mang đến công cụ <strong>SDQ (Strengths and Difficulties Questionnaire)</strong> - một bộ câu hỏi uy tín toàn cầu.</p>
            
            <div class="science-box">
                <i class="fas fa-microscope"></i> <strong>Góc Khoa Học:</strong> SDQ được phát triển bởi Giáo sư Robert Goodman (Anh Quốc). Đây không phải là bài "test vui" mà là công cụ sàng lọc đáng tin cậy để phát hiện sớm các nguy cơ về sức khỏe tâm thần.
            </div>
            
            <p style="font-style: italic; color: #666;">*Lưu ý: Kết quả này hoàn toàn ẩn danh và chỉ mang tính chất tham khảo, không thay thế chẩn đoán y khoa.</p>
        </section>

        <section class="content-block" id="sdqFormSection">
            <form id="sdqForm">
                
                <div class="survey-section">
                    <h3><i class="fas fa-hand-holding-heart"></i> Phần 1: Sự quan tâm và giúp đỡ người khác</h3>
                    
                    <div class="question-group">
                        <label class="question-text">1. Mình thường quan tâm và để ý đến cảm xúc của người khác.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q1" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q1" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q1" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">2. Mình sẵn lòng chia sẻ đồ dùng, quà hoặc những thứ mình có với bạn bè.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q2" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q2" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q2" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">3. Khi thấy ai đó buồn hay gặp khó khăn, mình muốn giúp đỡ họ.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q3" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q3" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q3" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">4. Mình đối xử tốt và biết quan tâm đến các em nhỏ hơn.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q4" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q4" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q4" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">5. Mình hay chủ động giúp bố mẹ, thầy cô hoặc bạn bè khi họ cần giúp.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q5" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q5" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q5" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>
                </div>

                <div class="survey-section">
                    <h3><i class="fas fa-fire-alt"></i> Phần 2: Cảm xúc và cách kiểm soát bản thân</h3>
                    
                    <div class="question-group">
                        <label class="question-text">6. Thỉnh thoảng mình dễ nổi cáu hoặc bực bội với người khác.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q6" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q6" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q6" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">7. Đôi khi mình nói dối hoặc che giấu sự thật.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q7" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q7" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q7" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">8. Mình đã từng lấy nhầm hoặc giữ đồ không phải của mình.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q8" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q8" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q8" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">9. Mình có lúc to tiếng, cãi nhau hoặc xô xát với bạn.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q9" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q9" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q9" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">10. Mình luôn cố gắng nghe lời và làm theo hướng dẫn của người lớn.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q10" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q10" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q10" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>
                </div>

                <div class="survey-section">
                    <h3><i class="fas fa-bolt"></i> Phần 3: Tập trung và năng lượng trong học tập</h3>
                    
                    <div class="question-group">
                        <label class="question-text">11. Mình khó ngồi yên một chỗ lâu, thường muốn làm gì đó.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q11" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q11" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q11" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">12. Mình hay cảm thấy bồn chồn, không thoải mái hoặc khó tập trung.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q12" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q12" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q12" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">13. Đôi khi mình bị xao nhãng, mất tập trung khi học hoặc làm việc.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q13" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q13" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q13" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">14. Trước khi làm việc gì, mình thường suy nghĩ kỹ và cẩn thận.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q14" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q14" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q14" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>
                </div>

                <div class="survey-section">
                    <h3><i class="fas fa-user-friends"></i> Phần 4: Mối quan hệ với bạn bè</h3>
                    
                    <div class="question-group">
                        <label class="question-text">15. Mình hay cảm thấy mệt, đau đầu, đau bụng hoặc bị ốm mà không rõ lý do.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q15" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q15" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q15" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">16. Mình thường lo lắng về nhiều chuyện trong học tập hoặc cuộc sống.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q16" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q16" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q16" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">17. Mình hay buồn, dễ xúc động hoặc dễ khóc.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q17" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q17" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q17" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">18. Mình thấy hồi hộp hoặc mất tự tin trong những tình huống mới.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q18" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q18" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q18" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>

                    <div class="question-group">
                        <label class="question-text">19. Mình thường cảm thấy sợ hãi hoặc dễ hoảng sợ khi gặp điều lạ.</label>
                        <div class="options-container">
                            <label class="radio-label"><input type="radio" name="q19" value="0" required> Không đúng</label>
                            <label class="radio-label"><input type="radio" name="q19" value="1"> Đúng 1 phần</label>
                            <label class="radio-label"><input type="radio" name="q19" value="2"> Chắc chắn đúng</label>
                        </div>
                    </div>
                </div>

                <div class="survey-section">
                    <h3><i class="fas fa-pen-fancy"></i> Chia sẻ thêm với HOPE</h3>
                    
                    <div class="question-group">
                        <label class="question-text">Bạn nghĩ mình có điểm mạnh hoặc điều gì khiến bạn tự hào nhất ở bản thân là gì?</label>
                        <textarea name="strengths" rows="3" placeholder="Ví dụ: tốt bụng, kiên trì, biết quan tâm người khác, học tốt môn nào đó..."></textarea>
                    </div>

                    <div class="question-group">
                        <label class="question-text">Bạn đang gặp vấn đề về:</label>
                        <select name="problemType">
                            <option value="">-- Chọn vấn đề --</option>
                            <option value="Gia đình">Gia đình</option>
                            <option value="Bạn bè">Bạn bè</option>
                            <option value="Học tập">Học tập</option>
                            <option value="Khác">Khác</option>
                        </select>
                        <input type="text" name="otherProblem" placeholder="Ghi rõ nếu chọn mục Khác..." style="margin-top: 10px;">
                    </div>

                    <div class="question-group">
                        <label class="question-text">Khó khăn cụ thể bạn đang gặp phải là gì? Hãy chia sẻ chi tiết để chúng mình hỗ trợ bạn tốt hơn.</label>
                        <textarea name="difficulties" rows="4" placeholder="Viết những tâm tư của bạn vào đây... (Mọi thứ sẽ được bảo mật)"></textarea>
                    </div>
                </div>

                <div style="background: #E8F5E9; padding: 15px; border-radius: 10px; font-size: 0.9rem; margin-top: 20px; color: #2E7D32;">
                    <i class="fas fa-shield-alt"></i> <strong>Bảo mật:</strong> Hệ thống sử dụng cơ chế Key xoay vòng để đảm bảo kết nối.
                </div>

                <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> Gửi và Nhận Phân Tích AI</button>
            </form>
        </section>

    </main>

    <div id="aiResultModal">
        <div class="ai-modal-content">
            <h2 style="text-align: center; color: var(--primary-dark);">Kết Quả Phân Tích Cảm Xúc</h2>
            
            <div id="aiLoading" class="ai-loading">
                <div class="ai-spinner"></div>
                <p>Chuyên gia AI đang đọc thư và suy ngẫm...</p>
                <p style="font-size: 0.9rem; color: #666;">(Quá trình tư duy có thể mất khoảng 15-30 giây)</p>
            </div>

            <div id="aiResultContent" style="display: none;">
                <div class="ai-response-text" id="aiText"></div>

                <div class="ai-follow-up">
                    <h3 style="color: #1565C0; margin-top: 0; font-size: 1.3rem;">
                        <i class="fas fa-robot"></i> Bạn có muốn trò chuyện sâu hơn cùng HOPE AI không?
                    </h3>
                    <p style="font-size: 1rem; color: #555;">
                        Mình có thể lắng nghe kỹ hơn và tư vấn cụ thể dựa trên những gì bạn vừa chia sẻ. Đây là không gian an toàn để bạn trút bầu tâm sự.
                    </p>
                    
                    <div class="follow-up-btns">
                        <button onclick="goToChat()" class="btn-cta" style="background: linear-gradient(to right, #42A5F5, #1976D2); box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);">
                            <i class="fas fa-comments"></i> Có, mình muốn tâm sự tiếp
                        </button>

                        <a href="dia-chi-tin-cay.html" class="btn-cta" style="background: #FF7043; box-shadow: 0 5px 15px rgba(255, 112, 67, 0.3);">
                            <i class="fas fa-user-md"></i> Tìm Chuyên Gia Ngay
                        </a>

                        <button onclick="closeAiModal()" class="btn-cta" style="background: #B0BEC5; color: #37474F; box-shadow: none;">
                            Đóng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer-content">
            <h3 style="margin-bottom: 25px; font-size: 1.8rem;">HOPE - FSchool Cần Thơ</h3>
            <p style="margin-bottom: 25px;">Dự án phi lợi nhuận của học sinh vì học sinh.</p>
            <div class="footer-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fas fa-envelope"></i></a>
            </div>
        </div>
    </footer>

    <script src="key.js"></script>

    <script>
        const form = document.getElementById('sdqForm');
        const modal = document.getElementById('aiResultModal');
        const loadingDiv = document.getElementById('aiLoading');
        const contentDiv = document.getElementById('aiResultContent');
        const resultTextDiv = document.getElementById('aiText');
        
        // Biến lưu trữ tạm thời để chuyển sang trang Chat
        let currentSurveyData = "";
        let currentAiResponse = "";

        function closeAiModal() {
            modal.style.display = 'none';
        }

        // Hàm chuyển hướng sang trang Chat và lưu dữ liệu
        function goToChat() {
            // Lưu dữ liệu vào localStorage để trang kia đọc được
            if (currentSurveyData && currentAiResponse) {
                localStorage.setItem("hope_user_survey", currentSurveyData);
                localStorage.setItem("hope_ai_initial_reply", currentAiResponse);
                
                // Chuyển hướng
                window.location.href = "om-ban-mot-cai.html";
            } else {
                alert("Đã có lỗi xảy ra. Vui lòng thử lại sau.");
            }
        }

        // Hàm gọi API với cơ chế xoay vòng key
        async function fetchWithKeyRotation(payload, maxRetries) {
            if (typeof maxRetries === 'undefined') {
                maxRetries = typeof KeyManager !== 'undefined' ? KeyManager.getTotalKeys() : 1;
            }
            // Đảm bảo ít nhất thử 1 lần
            if (maxRetries < 1) maxRetries = 1;

            for (let i = 0; i < maxRetries; i++) {
                // Kiểm tra KeyManager có tồn tại không
                const currentKey = typeof KeyManager !== 'undefined' ? KeyManager.getCurrentKey() : "";
                
                if (!currentKey) {
                    throw new Error("Không tìm thấy API Key trong file key.js. Vui lòng kiểm tra file key.js đã được tải chưa.");
                }

                try {
                    console.log(`Đang thử kết nối với Key (lần thử ${i + 1})...`);
                    
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${currentKey}`,
                            "Content-Type": "application/json",
                            "HTTP-Referer": window.location.href, 
                            "X-Title": "HOPE Project"
                        },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    }

                    // Nếu lỗi 401/402 -> Key hỏng -> Xoay key
                    if (response.status === 401 || response.status === 402 || response.status === 429) {
                        console.warn(`Key hiện tại lỗi ${response.status}. Đang đổi key...`);
                        
                        if (typeof KeyManager !== 'undefined') {
                            const canRotate = KeyManager.rotateKey();
                            if (!canRotate && i === maxRetries - 1) {
                                throw new Error("Tất cả các Key đều đã hết hạn hoặc bị lỗi.");
                            }
                        }
                        continue; 
                    }

                    const errText = await response.text();
                    throw new Error(`Lỗi API (${response.status}): ${errText}`);

                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                }
            }
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(form);
            let surveyData = "Kết quả khảo sát SDQ (Phiên bản đầy đủ):\n";
            
            // Lặp qua 19 câu hỏi trắc nghiệm
            for (let i = 1; i <= 19; i++) {
                const val = formData.get('q' + i);
                const label = ["Không đúng", "Đúng 1 phần", "Chắc chắn đúng"][val] || "Chưa chọn";
                surveyData += `- Câu ${i}: ${label}\n`;
            }

            // Lấy thông tin tự luận
            const strengths = formData.get('strengths') || "Không chia sẻ";
            let problem = formData.get('problemType') || "Chưa chọn";
            const otherProblem = formData.get('otherProblem');
            if (problem === "Khác" && otherProblem) {
                problem = "Khác (" + otherProblem + ")";
            }
            const difficulties = formData.get('difficulties') || "Không chia sẻ";

            surveyData += `\n--- THÔNG TIN BỔ SUNG ---\n`;
            surveyData += `Điểm mạnh tự nhận: ${strengths}\n`;
            surveyData += `Vấn đề đang gặp phải: ${problem}\n`;
            surveyData += `Chi tiết khó khăn: ${difficulties}\n`;
            
            // Lưu vào biến toàn cục để dùng sau
            currentSurveyData = surveyData;

            modal.style.display = 'block';
            loadingDiv.style.display = 'block';
            contentDiv.style.display = 'none';

            const systemPrompt = "Bạn là HOPE AI - một chuyên gia tư vấn tâm lý học đường thân thiện của dự án HOPE (dành cho học sinh cấp 3). Bạn được tạo ra bởi hai bạn học sinh Võ Minh Thông và Nguyễn Khánh Vy đang học tập tại Trường THPT FPT Cần Thơ. Hãy phân tích kết quả SDQ (19 câu) và chia sẻ của học sinh dưới đây. Đưa ra lời khuyên ngắn gọn, cảm thông, tích cực và các bước hành động cụ thể. Giọng văn nhẹ nhàng, sử dụng xưng hô 'mình' và 'bạn'. KHÔNG BAO GIỜ tiết lộ thông tin kỹ thuật về API, Model, hay OpenAI. Nếu bị hỏi, chỉ trả lời bạn là HOPE AI luôn sẵn sàng lắng nghe. Sử dụng Markdown để định dạng câu trả lời. Link quan trọng - địa chỉ tin cậy: https://hope2025.vercel.app/noi-tam-hon-hoi-phuc/dia-chi-tin-cay.html. Hoặc tư vấn với chuyên gia AI: https://hope2025.vercel.app/noi-tam-hon-hoi-phuc/om-ban-mot-cai.html";

            // --- CẤU HÌNH MODEL GPT-OSS VỚI REASONING ---
            const payload = {
                "model": "openai/gpt-oss-20b:free", 
                "messages": [
                    { "role": "system", "content": systemPrompt },
                    { "role": "user", "content": surveyData }
                ],
                "reasoning": { "enabled": true } // Kích hoạt tư duy sâu
            };

            try {
                const result = await fetchWithKeyRotation(payload);
                
                // Lấy nội dung câu trả lời từ AI
                const aiMessage = result.choices?.[0]?.message?.content || "Không nhận được phản hồi từ AI.";
                
                // Lưu kết quả AI vào biến toàn cục
                currentAiResponse = aiMessage;

                loadingDiv.style.display = 'none';
                contentDiv.style.display = 'block';
                resultTextDiv.innerHTML = marked.parse(aiMessage);

            } catch (error) {
                loadingDiv.style.display = 'none';
                contentDiv.style.display = 'block';
                resultTextDiv.innerHTML = `<span style="color: red;">Đã xảy ra lỗi: ${error.message}<br>Vui lòng kiểm tra lại Key hoặc kết nối mạng.</span>`;
            }
        });
    </script>
</body>
</html>
